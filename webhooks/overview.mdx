---
title: 'Visão Geral de Webhooks'
description: 'Receba notificações em tempo real sobre eventos na sua conta'
---

## O que são Webhooks?

Webhooks permitem que você receba notificações HTTP em tempo real quando eventos específicos ocorrem em sua conta, eliminando a necessidade de fazer polling constante da API.

<CardGroup cols={2}>
  <Card
    title="Eventos em Tempo Real"
    icon="bolt"
  >
    Receba notificações instantâneas quando eventos ocorrem
  </Card>
  <Card
    title="Reduza Requisições"
    icon="arrow-down"
  >
    Evite polling e economize em limites de taxa
  </Card>
  <Card
    title="Automatize Processos"
    icon="gears"
  >
    Crie fluxos automatizados baseados em eventos
  </Card>
  <Card
    title="Escalável"
    icon="chart-line"
  >
    Processe grandes volumes sem sobrecarga
  </Card>
</CardGroup>

## Como Funcionam

<Steps>
  <Step title="Configure um endpoint">
    Crie um endpoint HTTPS na sua aplicação para receber webhooks
  </Step>

  <Step title="Registre o webhook">
    Configure o webhook no painel ou via API
  </Step>

  <Step title="Selecione eventos">
    Escolha quais eventos você quer receber
  </Step>

  <Step title="Receba notificações">
    Quando um evento ocorre, enviamos um POST HTTP para seu endpoint
  </Step>

  <Step title="Processe e responda">
    Processe o evento e responda com 200 OK
  </Step>
</Steps>

## Eventos Disponíveis

<AccordionGroup>
  <Accordion icon="user" title="Eventos de Conta">
    - `account.created` - Nova conta criada
    - `account.updated` - Conta atualizada
    - `account.deleted` - Conta deletada
    - `account.suspended` - Conta suspensa
  </Accordion>

  <Accordion icon="megaphone" title="Eventos de Campanha">
    - `campaign.created` - Nova campanha criada
    - `campaign.started` - Campanha iniciada
    - `campaign.completed` - Campanha concluída
    - `campaign.failed` - Campanha falhou
  </Accordion>

  <Accordion icon="chart-line" title="Eventos de Monitor">
    - `monitor.alert` - Alerta de monitor disparado
    - `monitor.resolved` - Alerta resolvido
    - `monitor.threshold_exceeded` - Limite excedido
  </Accordion>

  <Accordion icon="bell" title="Eventos de Incidente">
    - `incident.created` - Novo incidente reportado
    - `incident.updated` - Incidente atualizado
    - `incident.resolved` - Incidente resolvido
  </Accordion>

  <Accordion icon="coins" title="Eventos de Créditos">
    - `credits.added` - Créditos adicionados
    - `credits.depleted` - Créditos esgotados
    - `credits.low_balance` - Saldo baixo de créditos
  </Accordion>
</AccordionGroup>

## Estrutura do Payload

Todos os webhooks seguem esta estrutura:

```json
{
  "id": "evt_1234567890",
  "type": "account.created",
  "created_at": "2026-01-09T10:30:00Z",
  "data": {
    "object": {
      "id": "acc_123",
      "name": "Nova Conta",
      "email": "user@example.com",
      "status": "active",
      "created_at": "2026-01-09T10:30:00Z"
    }
  },
  "previous_attributes": null
}
```

<ParamField path="id" type="string" required>
  ID único do evento
</ParamField>

<ParamField path="type" type="string" required>
  Tipo do evento (ex: `account.created`)
</ParamField>

<ParamField path="created_at" type="timestamp" required>
  Timestamp de quando o evento ocorreu
</ParamField>

<ParamField path="data.object" type="object" required>
  O objeto relacionado ao evento
</ParamField>

<ParamField path="previous_attributes" type="object">
  Para eventos `*.updated`, contém os valores anteriores dos campos alterados
</ParamField>

## Configurando Webhooks

### Via Painel de Controle

<Steps>
  <Step title="Acesse Webhooks">
    No painel, navegue até **Configurações → Webhooks**
  </Step>

  <Step title="Adicione um endpoint">
    Clique em **"Adicionar Endpoint"** e forneça:
    - URL do endpoint (deve ser HTTPS)
    - Descrição (opcional)
  </Step>

  <Step title="Selecione eventos">
    Escolha os eventos que deseja receber ou selecione "Todos os eventos"
  </Step>

  <Step title="Salve e teste">
    Salve a configuração e use o botão "Enviar Teste" para verificar
  </Step>
</Steps>

### Via API

<CodeGroup>
  ```bash cURL
  curl --request POST \
    --url https://api.example.com/v1/webhooks \
    --header 'Authorization: Bearer YOUR_API_KEY' \
    --header 'Content-Type: application/json' \
    --data '{
      "url": "https://yourapp.com/webhooks",
      "events": ["account.created", "account.updated"],
      "description": "Webhook de produção"
    }'
  ```

  ```javascript JavaScript
  const response = await fetch('https://api.example.com/v1/webhooks', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      url: 'https://yourapp.com/webhooks',
      events: ['account.created', 'account.updated'],
      description: 'Webhook de produção'
    })
  });

  const webhook = await response.json();
  console.log('Webhook ID:', webhook.id);
  ```

  ```python Python
  data = {
      'url': 'https://yourapp.com/webhooks',
      'events': ['account.created', 'account.updated'],
      'description': 'Webhook de produção'
  }

  response = requests.post(
      f'{base_url}/webhooks',
      json=data,
      headers=headers
  )

  webhook = response.json()
  print('Webhook ID:', webhook['id'])
  ```
</CodeGroup>

## Implementando um Endpoint

### Exemplo de Servidor

<CodeGroup>
  ```javascript Node.js/Express
  const express = require('express');
  const crypto = require('crypto');
  const app = express();

  app.post('/webhooks', express.raw({type: 'application/json'}), (req, res) => {
    const signature = req.headers['x-webhook-signature'];
    const payload = req.body;
    
    // Verifique a assinatura
    if (!verifySignature(payload, signature)) {
      return res.status(401).send('Invalid signature');
    }
    
    const event = JSON.parse(payload);
    
    // Processe o evento
    switch (event.type) {
      case 'account.created':
        handleAccountCreated(event.data.object);
        break;
      case 'account.updated':
        handleAccountUpdated(event.data.object);
        break;
      default:
        console.log(`Evento não tratado: ${event.type}`);
    }
    
    // Responda rapidamente
    res.status(200).send('OK');
  });

  function verifySignature(payload, signature) {
    const secret = process.env.WEBHOOK_SECRET;
    const hash = crypto
      .createHmac('sha256', secret)
      .update(payload)
      .digest('hex');
    return hash === signature;
  }

  app.listen(3000);
  ```

  ```python Python/Flask
  from flask import Flask, request, jsonify
  import hmac
  import hashlib

  app = Flask(__name__)

  @app.route('/webhooks', methods=['POST'])
  def webhook():
      signature = request.headers.get('X-Webhook-Signature')
      payload = request.get_data()
      
      # Verifique a assinatura
      if not verify_signature(payload, signature):
          return 'Invalid signature', 401
      
      event = request.get_json()
      
      # Processe o evento
      event_type = event['type']
      if event_type == 'account.created':
          handle_account_created(event['data']['object'])
      elif event_type == 'account.updated':
          handle_account_updated(event['data']['object'])
      else:
          print(f'Evento não tratado: {event_type}')
      
      # Responda rapidamente
      return 'OK', 200

  def verify_signature(payload, signature):
      secret = os.getenv('WEBHOOK_SECRET').encode()
      hash = hmac.new(secret, payload, hashlib.sha256).hexdigest()
      return hash == signature

  if __name__ == '__main__':
      app.run(port=3000)
  ```

  ```php PHP
  <?php
  $payload = file_get_contents('php://input');
  $signature = $_SERVER['HTTP_X_WEBHOOK_SIGNATURE'];

  // Verifique a assinatura
  $secret = getenv('WEBHOOK_SECRET');
  $hash = hash_hmac('sha256', $payload, $secret);

  if ($hash !== $signature) {
      http_response_code(401);
      die('Invalid signature');
  }

  $event = json_decode($payload, true);

  // Processe o evento
  switch ($event['type']) {
      case 'account.created':
          handleAccountCreated($event['data']['object']);
          break;
      case 'account.updated':
          handleAccountUpdated($event['data']['object']);
          break;
      default:
          error_log('Evento não tratado: ' . $event['type']);
  }

  // Responda rapidamente
  http_response_code(200);
  echo 'OK';
  ?>
  ```
</CodeGroup>

## Segurança

### Verificação de Assinatura

Todos os webhooks incluem um header `X-Webhook-Signature` que você deve verificar:

```javascript
const crypto = require('crypto');

function verifyWebhookSignature(payload, signature, secret) {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(payload)
    .digest('hex');
  
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedSignature)
  );
}
```

<Warning>
  **Sempre verifique a assinatura** antes de processar webhooks para garantir que eles vêm da nossa API.
</Warning>

### Obtendo o Secret

O secret do webhook é fornecido quando você cria o endpoint:

```json
{
  "id": "wh_123",
  "url": "https://yourapp.com/webhooks",
  "secret": "whsec_abcdef1234567890",
  "events": ["account.created"]
}
```

<Tip>
  Armazene o secret com segurança e nunca o exponha publicamente.
</Tip>

## Melhores Práticas

<AccordionGroup>
  <Accordion icon="bolt" title="Responda rapidamente">
    Retorne `200 OK` imediatamente e processe eventos de forma assíncrona.
    
    ```javascript
    app.post('/webhooks', async (req, res) => {
      // Responda imediatamente
      res.status(200).send('OK');
      
      // Processe assincronamente
      processWebhookAsync(req.body);
    });
    ```
  </Accordion>

  <Accordion icon="rotate" title="Implemente idempotência">
    O mesmo evento pode ser enviado múltiplas vezes. Use o `event.id` para deduplica.
    
    ```javascript
    const processedEvents = new Set();

    function processEvent(event) {
      if (processedEvents.has(event.id)) {
        console.log('Evento já processado:', event.id);
        return;
      }
      
      // Processar evento
      // ...
      
      processedEvents.add(event.id);
    }
    ```
  </Accordion>

  <Accordion icon="list-check" title="Valide o tipo de evento">
    Sempre verifique o tipo do evento antes de processar.
  </Accordion>

  <Accordion icon="clock-rotate-left" title="Implemente retry">
    Se o processamento falhar, tentaremos reenviar até 3 vezes com backoff exponencial.
  </Accordion>
</AccordionGroup>

## Testando Webhooks

### Enviar Webhook de Teste

Use o painel ou a API para enviar um evento de teste:

```bash
curl --request POST \
  --url https://api.example.com/v1/webhooks/wh_123/test \
  --header 'Authorization: Bearer YOUR_API_KEY'
```

### Usar Ferramentas Locais

Para desenvolvimento local, use ferramentas como:
- [ngrok](https://ngrok.com) - Crie túneis HTTPS para localhost
- [webhook.site](https://webhook.site) - Inspecione payloads

```bash
# Exemplo com ngrok
ngrok http 3000
# Use a URL gerada: https://abc123.ngrok.io/webhooks
```

## Monitoramento

Monitore seus webhooks no painel:
- Taxa de sucesso/falha
- Tempo de resposta médio
- Tentativas de reenvio
- Logs de eventos

<Card
  title="Dashboard de Webhooks"
  icon="chart-mixed"
  href="https://dashboard.example.com/webhooks"
>
  Visualize métricas e logs em tempo real
</Card>

## Troubleshooting

<AccordionGroup>
  <Accordion icon="exclamation-triangle" title="Webhooks não são recebidos">
    - Verifique se o endpoint está acessível publicamente via HTTPS
    - Confirme que está retornando 200 OK
    - Verifique logs de erro no painel
    - Teste com webhook.site primeiro
  </Accordion>

  <Accordion icon="clock" title="Timeout">
    - Responda com 200 OK imediatamente
    - Processe eventos de forma assíncrona
    - Nosso timeout é de 30 segundos
  </Accordion>

  <Accordion icon="copy" title="Eventos duplicados">
    - Implemente deduplicação usando `event.id`
    - Garanta operações idempotentes
  </Accordion>
</AccordionGroup>
